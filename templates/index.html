{% extends 'base.html' %}
{% block conteudo %}
{% with mensagens = get_flashed_messages() %}
  {% if mensagens %}
    <div class="mensagens-flash">
      {% for msg in mensagens %}
        <div class="alerta alerta-sucesso">{{ msg }}</div>
      {% endfor %}
    </div>
  {% endif %}
{% endwith %}
<div class="inicio">
    <div class="col-esquerda">
        <img src="../static/img/emote.gif" style="width:100%; transform: scaleX(-1); style">
    </div>
    <div class="col-centro">
            <script>
document.addEventListener("DOMContentLoaded", () => {
    const feed = document.querySelector('.feed');

    function criarBolinha() {
        const bolinha = document.createElement("img");
        bolinha.src = "../static/img/sem t√≠tulo.png"; 
        bolinha.classList.add("bolinha");

        const x = Math.random() * feed.offsetWidth;

        bolinha.style.left = `${x}px`;
        bolinha.style.top = `-40px`;
        bolinha.style.position = "absolute";

        feed.appendChild(bolinha);

        const duracao = 4000 + Math.random() * 3000;

        // Calcular altura total do feed dinamicamente
        const alturaFinal = feed.scrollHeight + 50;

        bolinha.animate(
            [
                { transform: "translateY(0)" },
                { transform: `translateY(${alturaFinal}px)` }
            ],
            {
                duration: duracao,
                easing: "linear"
            }
        ).onfinish = () => bolinha.remove();
    }

    setInterval(criarBolinha, 200);
});
</script>
        {% if 'username' in session %}
        <div class="form-post">
            <form action="{{ '/editarpost/'+post.idPost|string if post else '/novopost' }}" method="POST">

                <p>Ol√°, {{ session['username'] }}! Oque gostaria de postar hoje?</p>
                
            
                <input type="text" name="titulo" placeholder="T√≠tulo de postagem" value="{{ post.titulo if post }}"
                    required>
                <textarea name="conteudo" placeholder="Escreva aqui...." required></textarea>
                <button type="submit" style="background:#CF9698;">Postar</button>
            </form>
        </div>
        {% endif %}
        <div class="feed">
            {% if not postagens %}
            <p>Ainda n√£o temos posts! Volte mais tarde.</p>
            <img src="../static/img/erro.gif">
            {% else %}
            {% for post in postagens %}
            <div class="post">
                <div class="post-header">
                    <img src="{{ url_for('static', filename='uploads/' ~ post.foto) }}" class="post-foto-user">

                    <p>{{ post.username }} disse:</p>
                    <p>{{ post.dataPost.strftime("%d/%m/%y %H:%M:%S") }}</p>
                </div>
                <div class="post-content">
                    <h2>{{ post.titulo }}</h2>
                    <p>{{ post.conteudo }}</p>
                </div>
                {% if 'idUsuario' in session and session['idUsuario'] == post.idUsuario or 'admin' in session %}
                <div class="post-buttom" style="display: flex; gap: 10px; margin-top: 10px;">
                    <a href="/editarpost/{{ post.idPost }}" style="margin-top:10px;">
                    {% if 'admin' not in session %}
                        <button type="button"
                            style="background:rgb(84, 80, 3); color:white; border:none; padding:5px 10px; border-radius:5px; cursor:pointer;">
                            ‚úèÔ∏è
                        </button>
                    {% endif %}
                    </a>
                    <form action="/delete/{{ post.idPost }}" method="POST" style="margin-top:10px;" style="display: inline;" text>
                        <!-- action="/delete/{{ post.idPost }}":
Quando o bot√£o for clicado, o navegador manda uma requisi√ß√£o POST para /delete/1, /delete/2, etc. (dependendo do ID do post).
method="POST":
A exclus√£o s√≥ acontece com POST (boa pr√°tica, evita exclus√£o s√≥ clicando num link).-->
                        {% if 'admin' in session or 'idUsuario' in session and session['idUsuario'] == post.idUsuario %}
                        <button type="submit"
                            style="background:rgb(84, 80, 3); color:white; border:none; padding:5px 10px; border-radius:5px; cursor:pointer;"
                            onclick="return confirm('Tem certeza que deseja excluir este post?')">
                            üóëÔ∏è
                        </button>
                        {% endif %}
                    </form>
                </div>
                {% endif %}
            </div>
            {% endfor %}
            {% endif %}
        </div>
    </div>
    <div class="col-direita">
        <img src="../static/img/emote.gif" style= width:100%; height:65vh; >
    </div>

</div>
{% endblock %}